# CT Pathology Classification Reports

This directory contains Excel reports generated by the bulk inference pipeline for CT chest pathology classification.

## Report Format

Reports are generated in `.xlsx` format with the following naming convention:
```
report_{timestamp}_{uuid}.xlsx
```

Example: `report_20251002_183045_a3f9c2b1.xlsx`

## Report Structure

Each report contains the following columns:

| Column | Description | Type | Example |
|--------|-------------|------|---------|
| `path_to_study` | Path to the DICOM study ZIP file | String | `data/studies/patient_001.zip` |
| `study_uid` | StudyInstanceUID from DICOM metadata | String | `1.2.840.113619.2.55.3.12345678` |
| `series_uid` | SeriesInstanceUID from DICOM metadata | String | `1.2.840.113619.2.55.3.87654321` |
| `probability_of_pathology` | Pathology probability (0.0 or 1.0) | Float | `1.0` |
| `pathology` | Binary pathology indicator | Integer (0/1) | `1` |
| `processing_status` | Processing result status | String | `Success` or `Failure` |
| `time_of_processing` | Processing time in seconds | Float | `45.23` |
| `pathology_localization` | 3D bounding box of detected pathology | String | `120,350,80,420,50,180` |

## Pathology Classification Logic

- **With Pathology** (probability = 1.0, pathology = 1):
  - Segmentation detected one or more pathology classes
  - Bounding box calculated from segmentation mask

- **Without Pathology** (probability = 0.0, pathology = 0):
  - No pathology classes detected in segmentation
  - Empty bounding box

## Bounding Box Format

When pathology is detected, the `pathology_localization` column contains a 3D bounding box:
```
x_min,x_max,y_min,y_max,z_min,z_max
```

- **x_min, x_max**: Bounding box extent along X-axis (left-right)
- **y_min, y_max**: Bounding box extent along Y-axis (anterior-posterior)
- **z_min, z_max**: Bounding box extent along Z-axis (superior-inferior)

Coordinates are in voxel space of the original CT volume.

## Generation

Reports are automatically generated when running bulk inference:

```bash
python scripts/bulk_inference.py \
    --email admin@webapp.com \
    --password GYSgmXnhFR3p7-4x-2D21A \
    --studies-dir data/studies \
    --output-dir data/results
```

The Excel report will be saved to `data/reports/` with a unique timestamped filename.

## Example Report

| path_to_study | study_uid | series_uid | probability_of_pathology | pathology | processing_status | time_of_processing | pathology_localization |
|--------------|-----------|------------|-------------------------|-----------|-------------------|-------------------|----------------------|
| data/studies/patient_001.zip | 1.2.840.113619... | 1.2.840.113619... | 1.0 | 1 | Success | 45.23 | 120,350,80,420,50,180 |
| data/studies/patient_002.zip | 1.2.840.113619... | 1.2.840.113619... | 0.0 | 0 | Success | 38.91 | |
| data/studies/patient_003.zip | unknown | unknown | 0.0 | 0 | Failure | 12.45 | |

## Notes

- Failed studies have `processing_status = "Failure"` and `probability_of_pathology = 0.0`
- Studies without DICOM UIDs (due to upload failure) show `"unknown"` in UID columns
- Processing time includes upload, inference, and result download
- Reports are in human-readable Excel format for easy review and analysis
